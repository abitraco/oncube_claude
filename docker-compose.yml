services:
  oncube-app:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: oncube-web
    ports:
      - "80:80"
      - "443:443"
    environment:
      APP_ENV: production
      APP_DEBUG: "false"
      APP_KEY: "base64:FTCGjnnZRfCi9YnvGqK+AKvKNEJeIpYpzAfUKKnVzFA="
      APP_URL: https://oncube.cloud
      LOG_CHANNEL: stderr
      DB_CONNECTION: sqlite
      # Mail Configuration (Gmail SMTP)
      MAIL_MAILER: smtp
      MAIL_HOST: smtp.gmail.com
      MAIL_PORT: 465
      MAIL_USERNAME: oncube2019@gmail.com
      MAIL_PASSWORD: ${MAIL_PASSWORD:-}
      MAIL_ENCRYPTION: ssl
      MAIL_FROM_ADDRESS: oncube2019@gmail.com
      MAIL_FROM_NAME: "ONCUBE GLOBAL"
      # Admin Password
      ADMIN_PASSWORD: ${ADMIN_PASSWORD:-oncube2024}
    volumes:
      - oncube-storage:/app/storage
      - oncube-database:/app/database
      - oncube-writable:/app/writable
      - /etc/letsencrypt:/etc/letsencrypt:ro
      - /var/www/certbot:/var/www/certbot
    restart: unless-stopped
    command: >
      sh -c "
      chown -R application:application /app/storage /app/writable /app/database &&
      chmod -R 775 /app/storage /app/writable /app/database &&
      php artisan config:cache &&
      php artisan route:cache &&
      php artisan view:cache &&
      supervisord -c /opt/docker/etc/supervisor.conf
      "

volumes:
  oncube-storage:
    driver: local
  oncube-database:
    driver: local
  oncube-writable:
    driver: local
